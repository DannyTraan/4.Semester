/*
Deployment script for E18I4DABau556770

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "E18I4DABau556770"
:setvar DefaultFilePrefix "E18I4DABau556770"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 367)) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Creating [dbo].[AA]...';


GO
CREATE TABLE [dbo].[AA] (
    [_PersonID]         BIGINT        NOT NULL,
    [_AdresseID]        BIGINT        NOT NULL,
    [AlternativAdresse] NVARCHAR (50) NOT NULL,
    [_AAID]             BIGINT        IDENTITY (1, 1) NOT NULL,
    CONSTRAINT [pk_AA] PRIMARY KEY CLUSTERED ([_PersonID] ASC, [_AdresseID] ASC, [_AAID] ASC)
);


GO
PRINT N'Creating [dbo].[Adresse]...';


GO
CREATE TABLE [dbo].[Adresse] (
    [_AdresseID]   BIGINT        IDENTITY (1, 1) NOT NULL,
    [_GadeNavn]    NVARCHAR (50) NOT NULL,
    [_GadeNummer]  INT           NOT NULL,
    [_By]          NVARCHAR (50) NOT NULL,
    [_AdresseType] NVARCHAR (50) NOT NULL,
    [_ZipID]       BIGINT        NOT NULL,
    CONSTRAINT [pk_Adresse] PRIMARY KEY CLUSTERED ([_AdresseID] ASC)
);


GO
PRINT N'Creating [dbo].[Email]...';


GO
CREATE TABLE [dbo].[Email] (
    [_EmailID]      BIGINT        IDENTITY (1, 1) NOT NULL,
    [_EmailAdresse] NVARCHAR (50) NOT NULL,
    [_PersonID]     BIGINT        NOT NULL,
    CONSTRAINT [pk_Email] PRIMARY KEY CLUSTERED ([_EmailID] ASC)
);


GO
PRINT N'Creating [dbo].[Noter]...';


GO
CREATE TABLE [dbo].[Noter] (
    [_NoteID]   BIGINT        IDENTITY (1, 1) NOT NULL,
    [_Noter]    NVARCHAR (50) NOT NULL,
    [_PersonID] BIGINT        NOT NULL,
    CONSTRAINT [pk_Noter] PRIMARY KEY CLUSTERED ([_NoteID] ASC)
);


GO
PRINT N'Creating [dbo].[Person]...';


GO
CREATE TABLE [dbo].[Person] (
    [_PersonID]   BIGINT        IDENTITY (1, 1) NOT NULL,
    [_ForNavn]    NVARCHAR (50) NOT NULL,
    [_MellemNavn] NVARCHAR (50) NOT NULL,
    [_EfterNavn]  NVARCHAR (50) NOT NULL,
    [_AdresseID]  BIGINT        NULL,
    [_PersonType] NVARCHAR (50) NOT NULL,
    CONSTRAINT [pk_Person] PRIMARY KEY CLUSTERED ([_PersonID] ASC)
);


GO
PRINT N'Creating [dbo].[Telefon]...';


GO
CREATE TABLE [dbo].[Telefon] (
    [_TelefonID]   BIGINT        IDENTITY (1, 1) NOT NULL,
    [_TelefonType] NVARCHAR (50) NOT NULL,
    [_Nummer]      INT           NOT NULL,
    [_TeleSelskab] NVARCHAR (50) NOT NULL,
    [_PersonID]    BIGINT        NOT NULL,
    CONSTRAINT [pk_Telefon] PRIMARY KEY CLUSTERED ([_TelefonID] ASC)
);


GO
PRINT N'Creating [dbo].[ZIP]...';


GO
CREATE TABLE [dbo].[ZIP] (
    [_ZipID]      BIGINT        IDENTITY (1, 1) NOT NULL,
    [_PostNummer] INT           NOT NULL,
    [_Land]       NVARCHAR (50) NOT NULL,
    [_By]         NVARCHAR (50) NOT NULL,
    [_ZIPListeID] BIGINT        NOT NULL,
    CONSTRAINT [pk_ZIP] PRIMARY KEY CLUSTERED ([_ZipID] ASC)
);


GO
PRINT N'Creating [dbo].[ZIPListe]...';


GO
CREATE TABLE [dbo].[ZIPListe] (
    [_ZIPListeID] BIGINT        IDENTITY (1, 1) NOT NULL,
    [_PostNummer] INT           NOT NULL,
    [_Land]       NVARCHAR (50) NOT NULL,
    [_By]         NVARCHAR (50) NOT NULL,
    CONSTRAINT [pk_ZIPListe] PRIMARY KEY CLUSTERED ([_ZIPListeID] ASC)
);


GO
PRINT N'Creating [dbo].[fk_AA]...';


GO
ALTER TABLE [dbo].[AA] WITH NOCHECK
    ADD CONSTRAINT [fk_AA] FOREIGN KEY ([_PersonID]) REFERENCES [dbo].[Person] ([_PersonID]);


GO
PRINT N'Creating [dbo].[fk_AA2]...';


GO
ALTER TABLE [dbo].[AA] WITH NOCHECK
    ADD CONSTRAINT [fk_AA2] FOREIGN KEY ([_AdresseID]) REFERENCES [dbo].[Adresse] ([_AdresseID]);


GO
PRINT N'Creating [dbo].[fk_Adresse]...';


GO
ALTER TABLE [dbo].[Adresse] WITH NOCHECK
    ADD CONSTRAINT [fk_Adresse] FOREIGN KEY ([_ZipID]) REFERENCES [dbo].[ZIP] ([_ZipID]) ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Email]...';


GO
ALTER TABLE [dbo].[Email] WITH NOCHECK
    ADD CONSTRAINT [fk_Email] FOREIGN KEY ([_PersonID]) REFERENCES [dbo].[Person] ([_PersonID]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Noter]...';


GO
ALTER TABLE [dbo].[Noter] WITH NOCHECK
    ADD CONSTRAINT [fk_Noter] FOREIGN KEY ([_PersonID]) REFERENCES [dbo].[Person] ([_PersonID]) ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Person]...';


GO
ALTER TABLE [dbo].[Person] WITH NOCHECK
    ADD CONSTRAINT [fk_Person] FOREIGN KEY ([_AdresseID]) REFERENCES [dbo].[Adresse] ([_AdresseID]) ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_Telefon]...';


GO
ALTER TABLE [dbo].[Telefon] WITH NOCHECK
    ADD CONSTRAINT [fk_Telefon] FOREIGN KEY ([_PersonID]) REFERENCES [dbo].[Person] ([_PersonID]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[fk_ZIP]...';


GO
ALTER TABLE [dbo].[ZIP] WITH NOCHECK
    ADD CONSTRAINT [fk_ZIP] FOREIGN KEY ([_ZIPListeID]) REFERENCES [dbo].[ZIPListe] ([_ZIPListeID]) ON UPDATE CASCADE;


GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[AA] WITH CHECK CHECK CONSTRAINT [fk_AA];

ALTER TABLE [dbo].[AA] WITH CHECK CHECK CONSTRAINT [fk_AA2];

ALTER TABLE [dbo].[Adresse] WITH CHECK CHECK CONSTRAINT [fk_Adresse];

ALTER TABLE [dbo].[Email] WITH CHECK CHECK CONSTRAINT [fk_Email];

ALTER TABLE [dbo].[Noter] WITH CHECK CHECK CONSTRAINT [fk_Noter];

ALTER TABLE [dbo].[Person] WITH CHECK CHECK CONSTRAINT [fk_Person];

ALTER TABLE [dbo].[Telefon] WITH CHECK CHECK CONSTRAINT [fk_Telefon];

ALTER TABLE [dbo].[ZIP] WITH CHECK CHECK CONSTRAINT [fk_ZIP];


GO
PRINT N'Update complete.';


GO
